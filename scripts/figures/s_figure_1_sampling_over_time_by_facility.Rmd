---
title: "Supplemental Figure 1: Sampling by facility in 2021-23 study"
author: "Kyle Gontjes"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
require(knitr)
opts_knit$set(echo = T,warning = FALSE, message = FALSE,error=F,comment=NA) 
opts_chunk$set(echo = T,warning = FALSE, message = FALSE,error=F,comment=NA)
opts_knit$set(root.dir='~/Desktop/gl_nfs/Project_INTEGRATE/Analysis/Resistance_dynamics/INTEGRATE-resistance-ms')
```

# Environment
```{r}
# Packages
packages <- c("tidyverse")
lapply(packages,library,character.only=T)

# Functions
source("./lib/consistent_themes.R")

# Print environment
Sys.info()
sessionInfo() 
```

# Load data
```{r}
df <- readRDS("./data/dataset/CA_LTACH_first_clinical_CRKP_genomes_merged_studies_metadata.RDS")   

df_201415 <- df%>% subset(study == "2014-15")
df_202123 <- df%>% subset(study == "2021-23")

df_202123_all <- readRDS("./data/dataset/CA_LTACH_CRE_genomes_merged_studies_metadata.RDS") %>% subset(study == '2021-23') 
```

# Sampling over time
```{r}
number_of_months <- round(as.numeric(round(difftime(max(df_202123_all$date,na.rm=T),min(df_202123_all$date,na.rm=T),units = 'days')))) / 365 * 12
```

```{r} 
figure <- ggplot(data = df_202123 %>% subset(is.na(hospital_location)==F)) +
  geom_histogram(aes(x = date), binwidth = number_of_months,colour = 'black',fill='black') +
  facet_wrap(~hospital_location_recode) +
  xlab("") +
  ylab("Number of isolates") +
  labs(fill = "") +
  scale_x_date(
    date_breaks = "3 month",
    date_labels = "%b %Y" )  +
  theme_bw_me +
  theme(
    strip.text = element_text(size =12),
    axis.text.x = element_text(angle = 90, hjust = 0.5,vjust=0.5)
  )  + scale_y_continuous(breaks = c(0,2,4,6,8),labels = c(0,2,4,6,8),limits = c(0,8.1)) 
```

```{r,fig.width=8.75,fig.height=7}
figure
```

```{r}
ggsave(plot=figure,filename = './figures/s_figure_1_sampling_over_time_and_space.png',bg='white', dpi=900, height=7, width=8.75)
```
