---
title: "Results section 1: Propsective surveillance of CRKP from California LTACHs"
author: "Kyle Gontjes"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
require(knitr)
opts_knit$set(echo = F,warning = FALSE, message = FALSE,error=F,comment=NA) 
opts_chunk$set(echo = F,warning = FALSE, message = FALSE,error=F,comment=NA)
opts_knit$set(root.dir='~/Desktop/gl_nfs/')
```


```{r} 
# Packages
packages <- c("tidyverse","gridExtra","kableExtra","tableone","gontjesr")
lapply(packages,library,character.only=T)

# Functions
source("./Project_INTEGRATE/Analysis/Resistance_dynamics/INTEGRATE-resistance-ms/lib/consistent_themes.R")

# Print environment
Sys.info()
sessionInfo()
```

# Load data

```{r}
df <- readRDS("~/Desktop/gl_nfs/Project_INTEGRATE/Analysis/Resistance_dynamics/2025-09-18_master_kpn_first_isolate_dataset_curation/results/CA_clinical_CRKP_first_isolate_metadata_091825.RDS")  

df_201415 <- df%>% subset(study == "2014-15")
df_202123 <- df%>% subset(study == "2021-23")

df_202123_all <- readRDS("~/Desktop/gl_nfs/Project_INTEGRATE/Analysis/Resistance_dynamics/2025-09-18_master_kpn_first_isolate_dataset_curation/results/CA_clinical_CRE_metadata_091825.RDS")  %>% subset(study == '2021-23')
```


# Overview of clinical specimens from 2021-23
```{r}
paste0("Number of specimens: ",nrow(df_202123))
paste0("Number of patients: ",length(unique(df_202123$participant_id %>% subset(is.na(.)==F))))

paste0("Minimum date: ",min(df_202123$date,na.rm=T))
paste0("Maximum date: ",max(df_202123$date,na.rm=T))

paste0("Number of facilities: ",length(unique(df_202123$hospital_location %>% subset(.!='NA'),na.rm=T)))
```

# INTEGRATE metadata availability
```{r}
df_202123_no_metadata <- df %>% subset(is.na(hospital_location) & study =='2021-23')
df_202123_w_metadata <- df %>% subset(is.na(hospital_location)==F& study =='2021-23')
df_w_metadata <- df %>% subset(is.na(hospital_location)==F)

paste0("Number of isolates with metadata: ",nrow(df_202123_w_metadata))
paste0("Proportion of isolates with metadata: ",round(nrow(df_202123_w_metadata)/ sum(nrow(df_202123_no_metadata),nrow(df_202123_w_metadata)),3))
```

# Anatomical site
```{r} 
convert_tableone_into_df(dataset=df_202123_w_metadata,vars = "source_simplified") 
``` 